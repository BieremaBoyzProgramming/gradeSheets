/**
 * Author: Bierema Boyz Publishing
 * Copyright (c) 2015 Bierema Boyz Publishing. All rights reserved.
 * @license MIT
 */
var bieremaBoyz=bieremaBoyz||{};bieremaBoyz.gradeSheets=bieremaBoyz.gradeSheets||{},bieremaBoyz.gradeSheets.parseDSV=function(){function e(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function a(e){return String.fromCharCode.apply(null,e.byteLength>=2&&65279===new Uint16Array(e,0,2)[0]?new Uint16Array(e,2):new Uint16Array(e))}importScripts("https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js");var t;onmessage=function(r){var n;if(r.data.file)t=r.data.file;else{var s=new Uint8Array(r.data,0,Math.min(3,r.data.byteLength)),o=[];(r.data.byteLength<2||65279!==new Uint16Array(r.data,0,Math.min(2,r.data.byteLength))[0])&&o.push(e),r.data.byteLength%2||[239,187,191].every(function(e,a){return e===s[a]})||o.push(a);var i="text/csv"===t.type||/\.csv$/i.test(t.name)?[d3.tsv,d3.csv]:[d3.csv,d3.tsv],l=[];i.forEach(function(e){o.forEach(function(a){l.push({parser:e,decoder:a})})});for(var g=[];l.length;){var d=l.pop(),c=d.parser.parseRows(d.decoder(r.data)),h={assignment:!0,total:!0,category:[],class:!0},u=[],f=-1,p=null;for(c.reverse();c.length;){var m=c.pop();if(m[0]){var y=m[0].toLowerCase();if(h.hasOwnProperty(y)?h[y]=m:u.push(m),m.length>f){if(f>=0){p="All rows must contain the same number of cells.";break}f=m.length}}}if(p)g.push(p);else if(h.assignment.length)if(h.total.length){if(h.class.length){var v=[],b={};v.categories=[],v.file=t,v.name=h.class[1];var w=[];for(h.category.length||(h.category=Array.apply(null,Array(f)).map(String)),n=1;f>n;n++)if(h.assignment[n]){var A=h.category[n];b[A]||(b[A]=!0,v.categories.push(A)),w[n]={name:h.assignment[n],total:h.total[n]}}return u.forEach(function(e,a){var t=[];for(t.index=a,t.class=v,t.name=e[0],t.assignments={},v.categories.forEach(function(e){var a=[];a.category=e,t.assignments[e]=a}),a=1;a<e.length;a++)w[a]?t.assignments[h.category[a]].push({student:t,assignment:w[a],score:e[a]}):e[a]&&t.push(e[a]);v.push(t)}),void postMessage(v)}g.push('A row labeled "class" could not be found.')}else g.push('A row labeled "total" could not be found.');else g.push('A row labeled "assignment" could not be found.')}g.unshift(": The following error messages resulted while attempting to use various encodings and delimiters:"),postMessage({error:{beginning:"Error parsing file ",end:g.join("<br>")}})}}},"undefined"==typeof window&&bieremaBoyz.gradeSheets.parseDSV();
//# sourceMappingURL=../../build/parseDSV.js.map